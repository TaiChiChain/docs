---
title: "Architecture"
---

# 简介

为了方便大家更好的了解 Axiomesh 本章节中我们将对 Axiomesh 的体系架构进行介绍，我们会首先从宏观的 Axiomesh
的网咯拓扑结构开始分析，Axiomesh 是由一群通过 P2P 连接的计算机节点所组成，这里的节点我们又称之为验证节点（Validator）。
接下去我们会对每一个验证节点进行展开介绍，讲解每个验证节点的内部组成，最后针对验证节点的核心组件再逐步展开。从而为
用户呈现出整体的 Axiomesh 的从宏观到微观的完整体系架构。

# 网络拓扑

如下图所示是 Axiomesh 区块链网络的拓扑结构，该网络的主要组成部分包括 Axiomesh 的区块链节点、钱包和区块链浏览器。其中，区块链节点通过 P2P 网络
连接的方式连接成网，并通过共识算法共同维护区块链账本；钱包服务是 用户/DAPP 与区块链节点交互的核心桥梁，负责提交到区块链的交易的前面以及交易转发的
工作；区块链浏览器和区块链节点相连接，负责解析和结构化的存储区块链上核心的数据，为终端用户提供可视化的区块链数据。
区块链节点依据其参与共识的情况又会分成新节点、候选者节点和验证者几点几个不同角色，其中新节点是尚未通过治理投票通过获取入网许可的区块链节点，候选者
节点指的是在当前阶段未参与共识出块的节点，验证者节点则是当前阶段被选举出来直接参与出块的区块链节点。

![Axiomesh 区块链网络拓扑图](../../images/system-design/axiomledger-topology-cn.png)


# 节点架构

为了方便去中心化节点核心服务的复用，Axiomesh 区块链节点采用了一种”内核+应用“分离的模块化设计模式，应用层通过核心层调用接口
来调用内核层的服务，例如P2P 网络服务，存储服务等。独立出来的 Axiomesh 将来还可以方便开发 Axiomesh 的Layer2 服务、跨链桥
服务以及去中心化存储服务等去中心化应用。

* 应用程序运行时：承载具体的去中心化应用的应用层逻辑，在本章节中该部分实现了 Axiomesh 验证者节点的核心逻辑，包括EVM 兼容的
RPC 服务、交易执行器、区块链账本服务、交易内存池、共识算法、跨链桥以及访问控制逻辑；

* 核心调用接口层：核心层调用接口封装了 Axiom 内核层的服务，对外呈现出简单易用的访问接口，而屏蔽了具体的实现细节，方便应用程序
运行时开发者快速开发去中心化程序的核心业务逻辑；

* Axiom 内核层：类似于操作系统的内核层，Axiomesh 的内核层封装了大量开发去中心化应用程序的原语，包括点对点网络服务、节点
配置管理服务、存储服务、加密服务、监控服务以及加密账户管理服务等。

![Axiomesh 验证节点架构图](../../images/system-design/axiomledger-architecture-cn.png)

## 节点分类

区块链节点按照其是否直接参与共识，可以分成验证者节点、候选者节点和新节点，各个节点角色之间可以互相转换，具体的转换逻辑
参考共识算法的相关章节（XX章、XX节）

# 节点核心组件

Axiomesh 区块链节点负责区块链网络的账本数据存储、交易执行、状态服务等核心业务，每个区块链节点的由多个相关的逻辑组件
组成：

## 接口服务

为了兼容 EVM 生态工具，Axiomesh 区块链的接口服务采用了 Ethereum 兼容的 JSON RPC 服务。核心的访问 EVM 的接口均实现兼容，包括
合约部署、调用、链的基本信息查询等。除此之外，Axiomesh 区块链扩展了接口的服务主要用于和区块链的原生治理服务交互，包括提案管理、治理成员管理、
节点升级等。

## 内存池

交易内存池组件主要用于缓存和管理提交到区块链节点的交易，这些交易尚未被打包和执行，交易内存池的数据仅在验证者节点之间完整同步。交易内存池内的交易
有两个来源，一个是自身节点直接通过 RPC 服务接收来自应用提交的交易，另一个则是通过网络服务接受来自其它验证者节点转发而来的交易。当本节点是共识算法
中的出块节点时，共识算法将会从交易内存池中拉取一定数量的交易并组成一个区块，并将该区块广播给网络中的其他验证者节点。当该区块被共识网络共识之后
各个验证者节点执行区块中的交易并刷新账本记录。

## 执行器

执行器组件是区块链节点执行交易逻辑的核心组件，执行器接收来自共识确定好顺序的交易列表，通过调用底层的合约执行引擎执行具体交易，并产生临时的账本
变更，当交易的执行结果通过共识之后，变更数据通过账本写入持久化的账本状态数据中。执行器依据所执行交易的类型不同调用不同的合约执行引擎，Axiomesh 区块链
内部包含系统合约执行引擎和 EVM 等效合约执行引擎：

* 系统合约执行引擎：用于执行系统内置合约，包括治理合约、升级合约、经济管理合约等区块链系统管理合约；
* EVM 等效执行引擎：用于执行外部用户提交的合约，包括 ERC20, ERC721, DEX 等各种 DAPP 业务逻辑合约；

## 共识

共识组件负责区块链交易顺序的确定以及区块链账本状态的一致性校验，Axiomesh 区块链采用 dBFT(delegated Byzantine Fault Tolerance) 兼顾节点
的规模和快速一致性。dBFT 在传统 BFT 算法的基础上引入纪元(epoch)的概念，在每个纪元开始之初，dBFT 算法采用随机可验证函数从验证节点和候选节点组成
节点结合中选举固定数量的新的验证者节点集合，这些新的验证者节点将持续工作直到下一个纪元的开始。

## 账本

账本组件提供了对区块链的世界状态数据和区块数据的管理能力。其中状态数据包括账户的相关信息，如余额、权限、nonce值等，对于特殊账户如合约账户还包含了合约
的字节码以及合约内所有涉及的变更状态。另外，账本还提供了区块数据的管理能力，区块类数据包括区块、交易、交易回执等持久化非变更类数据，主要提供这类数据的存储和查询
服务。此外，账本模块还能够依赖默克尔树来提供账本内关键数据的默克尔证明的能力。

## 跨链桥

跨链桥组件负责管理 Axiomesh 区块链的跨链相关服务，包括跨链交易的出入通道、跨链交易的中继路由、跨链服务的预言机等。

## 访问控制

访问控制组件提供了交易的安全校验的能力，该组件提供基础的交易合法性校验服务，包括交易体格式、签名信息、Gas 费用等等。