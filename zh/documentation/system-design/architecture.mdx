---
title: "系统架构"
---

## 简介

为便于读者全面理解 AxiomLedger 的体系架构，本章将从宏观到微观对其进行详细介绍。
首先，从网络拓扑结构来看，AxiomLedger 由多个验证节点通过P2P连接组成。这些验证节点构成了AxiomLedger 的基础设施。 
其次，我们将深入验证节点的内部结构。每一个验证节点都包含多种核心组件，共同实现交易处理、共识等功能。
最后，我们将一一分析各核心组件的细节,包括其职责、交互接口等。这将呈现出从整体网络、单个节点到组件级别的全面系统架构。

## 网络拓扑

AxiomLedger 网络由以下主要组成部分构成(如下图所示):

- `区块链节点`:通过P2P网络连接，使用共识算法维护共同账本。节点角色分为新节点、候选节点和验证节点(包括特殊的出块节点)，依据其参与共识程度划分，节点角色可以互相转换，具体可以参考[共识](/zh/documentation/system-design/consensus)。
- `钱包服务`:用户/DApp与区块链交互的桥梁，负责构造和转发交易。
- `区块链浏览器`:连接区块链节点，对链上数据进行存储和解析，为用户提供区块链数据的可视化访问。

具体而言，新节点是尚未通过治理投票获取入网许可的节点，候选节点是当前未参与共识出块的节点，验证节点是通过选举参与出块的节点，出块节点是验证节点中打包出块的节点。

![AxiomLedger 网络拓扑图](/zh/images/system-design/axiomledger-topology.png)


## 节点架构

为了方便去中心化节点核心服务的复用，Axiomesh 生态采用了一种”内核+系统+应用“分离的模块化设计模式，内核层负责通用的去中心化系统的底层功能（如
P2P、存储、监控、配置等）；系统层可以利用内核层服务来构建去中心化系统服务，如区块链链服务、Layer 2 （执行层）服务、跨链桥服务以及
去中心化存储（数据可用）服务等；最后在应用层可以利用系统层提供的 API 服务来构建去中心化应用（如 稳定币、RWAs、NFT、DeFi 等）。

本章将重点介绍系统层区块链 `AxiomLedger` 验证节点的组件架构，包括EVM 兼容的RPC 服务、交易执行器、区块链账本服务、交易内存池、共识算法、跨链桥以及访问控制逻辑；

![AxiomLedger 验证节点架构图](/zh/images/system-design/axiomledger-architecture.png)


## AxiomLedger 节点核心组件

AxiomLedger 节点负责区块链网络的账本数据存储、交易执行、状态服务等核心业务，每个区块链节点的由多个相关的逻辑组件组成：

### 接口服务

为了兼容 EVM 生态工具，AxiomLedger 的接口服务采用了 Ethereum 兼容的 JSON RPC 服务。核心的访问 EVM 的接口均实现兼容，包括
合约部署、调用、链的基本信息查询等。除此之外，Axiomesh 区块链扩展了用于和区块链的原生治理服务交互相关的接口，包括提案管理、治理成员管理、
节点升级等。

### 交易池

交易内存池组件主要用于缓存和管理提交到区块链节点的交易，这些交易尚未被打包和执行，交易内存池的数据仅在验证者节点之间完整同步。交易内存池内的交易
有两个来源，一个是自身节点直接通过 RPC 服务接收来自应用提交的交易，另一个则是通过网络服务接受来自其它验证者/候选者节点转发而来的交易。当本节点是共识算法
中的出块节点时，共识算法将会从交易内存池中拉取一定数量的交易组成一个区块，并将该区块广播给网络中的其他验证者节点。当该区块被共识网络共识之后
各个验证者节点执行区块中的交易并刷新账本记录。

### 执行器

执行器组件是区块链节点执行交易逻辑的核心组件，执行器接收来自共识确定好顺序的交易列表，通过调用底层的合约执行引擎执行具体交易，并产生临时的账本
变更，当交易的执行结果通过共识之后，变更数据通过账本写入到持久化的账本状态数据库中。执行器依据所执行交易的类型不同调用不同的合约执行引擎，AxiomLedger
内部包含系统合约执行引擎和 EVM 等效合约执行引擎：

* `系统合约执行引擎`：用于执行系统内置合约，包括治理合约、升级合约、经济管理合约、纪元管理合约等区块链系统管理合约；
* `EVM 等效执行引擎`：用于执行外部用户提交的合约，包括 ERC20, ERC721, DEX 等各种 DAPP 业务逻辑合约；

### 共识

共识组件负责区块链交易顺序的确定以及区块链账本状态的一致性校验，AxiomLedger 采用 `dBFT`(delegated Byzantine Fault Tolerance) 共识算法，兼顾了节点
的规模和快速一致性。`dBFT` 在传统 BFT 算法的基础上引入纪元(`epoch`)的概念，在每个纪元开始之初，`dBFT` 算法采用随机可验证函数从验证节点和候选节点组成
节点集合中选举固定数量的新的验证者节点集合，这些新的验证者节点将持续工作直到下一个纪元的开始。

### 账本

账本组件提供了对区块链的世界状态数据和区块数据的管理能力。其中状态数据包括账户的相关信息，如余额、权限、nonce值等，对于特殊账户如合约账户还包含了合约
的字节码以及合约内所有涉及的变更状态。另外，账本还提供了区块数据的管理能力，区块类数据包括区块、交易、交易回执等持久化非变更类数据，主要提供这类数据的存储和查询
服务。此外，账本模块还能够依赖默克尔树来提供账本内关键数据的默克尔证明的能力。

账本组件负责管理区块链的世界状态和区块数据:

1. `状态数据`:包括账户信息如余额、权限、nonce等，对于智能合约账户还包含合约字节码和相关的状态变更。
2. `区块数据`:包括区块、交易、交易回执等持久化非状态变更数据，提供存储和查询服务。
3. `默克尔证明`:通过默克尔树,可以对账本中的关键数据生成默克尔证明。

账本组件以状态和区块两类数据为目标,分别采用适合其访问模式的数据结构,可以高效管理区块链核心数据。同时支持生成默克尔证明,有助于数据可验证性。
这样的设计使得账本组件能够满足区块链对状态变更、历史记录、数据证明等多方面的需求。

### 跨链桥

跨链桥组件负责管理 AxiomLedger 的跨链相关服务，包括跨链交易的出入通道、跨链交易的中继路由、跨链服务的预言机等。

### 访问控制

访问控制组件提供了交易的安全校验的能力，该组件提供基础的交易合法性校验服务，包括交易体格式、签名信息、Gas 费用等等。