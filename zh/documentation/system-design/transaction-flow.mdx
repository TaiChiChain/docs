---
title: "工作流"
---

为了进一步深入理解AxiomLedger区块链交易的全生命周期，本节将详细跟踪一笔交易在验证者节点内各个组件之间的
流转路径，剖析交易在每个组件的处理逻辑。下图展示了一笔进入AxiomLedger区块链节点的交易处理流程:

![AxiomLedger 区块链交易流程图](/zh/images/system-design/axiomledger-tx-flow.png)

通过跨节点组件的交易工作流程，可以清晰地看到交易从进入节点到被打包成区块的端到端流程，包括验证、排序、共识等处理阶段。每个组件实现的逻辑将在下文中详细介绍。​

## 提交交易

终端用户可以直接通过钱包（如 MetaMask）或者通过 DAPP 构造区块链原始交易，并使用私钥签名（通常也是借助钱包完成）后发送到区块链节点。
发送到区块链的合法交易至少包括：
* [原始交易体](/zh/documentation/core-concepts/transactions)
* 用户的公钥
* 用户对该交易的签名

## 接收交易

AxiomLedger 的 RPC 接口模块负责接收来自终端用户提交的交易请求。为了兼容以太坊生态，AxiomLedger 实现了大多
数以太坊 RPC 接口规范，同时也提供了额外的定制化治理服务接口。
为防止 DoS 攻击，RPC接口模块具备流控能力。当交易请求超过系统处理极限时，会直接拒绝该请求；而在处理能力范围内的交易，则会转发给内部的访问控制服务进行后续处理。


## 验证交易

访问控制组件会对用户提交的交易进行安全校验,主要包括:

- 交易格式合法性校验:检查交易参数是否符合规范。
- 签名合法性校验:验证用户签名是否有效。 
- 余额校验:检查用户是否有足够余额支付 Gas 费用。
- 序列号校验:验证交易序列号是否正序。

对于校验失败的非法交易,直接丢弃。合法交易则缓存到交易池待打包。


## 共识交易

对于进入交易池的交易，AxiomLedger 将会执行执行两个操作：1）通过网络服务将该交易转发给区块链网络上的邻近节点；2）如果该验证节点是共识节点的主节点
时，其会定期从交易池中取出批量交易，并发起共识提案。此后共识算法执行多轮共识步骤以使得网络上的大部分验证节点对该批量交易的顺序达成一致。

## 执行交易

对于经过共识算法确认的批量交易（区块）会被输入到执行器中进行执行，AxiomLedger 的执行器依据交易的类型会调用不同的执行器来进行交易的处理。对于系统交易调用系统合约进行处理，对于普通交易会调用 EVM 虚拟机进行处理。执行交易完成后会导致账本世界状态的变更，执行器将世界状态的变更连同区块
一起发送到账本模块。


## 持久化状态

账本模块依据变更数据类型的不同调用底层的不同的存储引擎进行数据存储。对于世界状态的变更通过底层的KV数据库进行数据的持久化，对于区块类数据则调用底层的顺序型数据库进行存储。
