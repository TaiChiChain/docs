---
title: "虚拟机"
---

## 虚拟机

AxiomLedger 除了对 AXC 进行账本的活动记录，同时也支持了更强大的功能——智能合约和系统合约。对于这两个功能，AxiomLedger 构建了类似于以太坊的分布式状态机器。AxiomLedger 的状态是一个大型数据结构，它不仅保存所有帐户和余额，还保存了一个机器状态，它可以根据预定义的一组规则在不同的区块之间进行更改，并且可以执行任意的机器代码。AxiomLedger 账本上所存储的状态可以通过智能合约和系统合约来进行读取和修改。

## 智能合约

智能合约是一个运行在 AxiomLedger 链上的一个程序。 它是位于 AxiomLedger 区块链上一个特定地址的一系列代码（函数）和数据（状态）。

智能合约也是一个 AxiomLedger 帐户，我们称之为合约帐户。 这意味着它们有余额，可以成为交易的对象。 但是，他们无法被人操控，他们是被部署在网络上作为程序运行着。 个人用户可以通过提交交易执行智能合约的某一个函数来与智能合约进行交互。

智能合约能像常规合约一样定义规则，并通过代码自动强制执行。 默认情况下，智能合约无法删除，与它们的交互是不可逆的。

在 AxiomLedger，智能合约的执行是通过 EVM 虚拟机来执行的。

## 交易到虚拟机到账本

当一条交易被发送到区块链上，并送入到执行模块后，交易的各个字段将会被解析，执行器可以通过交易的目标字段来判断该交易是智能合约还是系统合约。

当执行器发现交易的目标地址是智能合约时，将会从区块链账本中读取对应的智能合约的执行代码并且加载到 EVM 中进行执行。

当执行器发现交易的目标地址是系统合约时，将会直接将交易送入到系统合约中进行执行。

![tx-executor](/zh/images/tx_exe.png)

智能合约和系统合约都可以通过账本提供的特定接口来访问账本的状态。

## 系统合约

系统合约执行流程如下图所示，主要步骤如下：

1. 交易进入执行器，执行该交易；

2. 判断交易的 `To` 地址是否为系统合约地址，是则执行下一步，否则在 EVM 中执行该交易并返回执行结果；

3. 读取系统合约地址对应的对象实例；

4. 解析执行的参数并调用对象实例的执行函数；

5. 返回执行结果。

<img src="/zh/images/vm_system_contract.png" width="400" />
